<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="description" content="">
        <meta name="author" content="">

        <title>Blast</title>

        <!-- Bootstrap core CSS -->
        <link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.min.css">
        <!-- Custom CSS stylesheet -->
        <link rel="stylesheet" href="Styles/dashboard.css">

    </head>

    <body>
      <header>
        <nav class="navbar navbar-expand-md navbar-dark fixed-top">
          <img src="images/blast-icon.png" alt="Blast Icon" style="width:55px; height:55px;">
          <button class="navbar-toggler d-lg-none" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>

          <div class="collapse navbar-collapse" id="navbarsExampleDefault">
             <ul class="navbar-nav mr-auto">
               <li class="nav-item active">
                 <a class="nav-link" href="#">Session Data <span class="sr-only">(current)</span></a>
               </li>
               <li class="nav-item">
                 <a class="nav-link" href="#">Leaderboard</a>
               </li>
               <li class="nav-item">
                 <a class="nav-link" href="#">Lifetime Stats</a>
               </li>
               <li class="nav-item">
                 <a class="nav-link" href="#">Settings</a>
               </li>
             </ul>
           </div>
          </nav>
        </header>

        <div class="container-fluid">
          <div class="row">
            <nav class="col-sm-3 col-md-2 d-none d-sm-block bg-light sidebar">
              <ul class="nav nav-pills flex-column">
                <li class="nav-item">
                  <a class="nav-link active" href="#"><img src="images/fortnite.png" style="width:60px; height:60px> <span class="sr-only"></span></a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="#"><img src="images/apex.png" style="width:60px; height:60px"> </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="#"><img src="images/csgo.png" style="width:60px; height:60px"> </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="#"> <img src="images/hs.png" style="width:60px; height:60px"> </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>

        <main role="main" class="col-sm-9 ml-sm-auto col-md-11 pt-3">
        <h1 style="text-align:center; padding-top:40px;">Blastphemy01's Recent Games</h1>

        <script type="text/javascript">
            'use strict';
            const fs = require('fs');
            // the path below will not work on your machine
            let files = fs.readdirSync('/Users/TheEWL/Desktop/Replays');

            console.log(files.length)

            let i = 1
            let id = 0
            var mysql = require('mysql');
            var connection = mysql.createConnection({
                host: "MacBook-Air.local",
                user: "guest",
                password: "9879968b",
                database: "fortniteINFO"
            });

            //Array for storing data from database
            let FortNiteData = [0, 0, 0, 0, 0, 0]
            //Counter to iterate through columns in database
            let ctr = 0;

            files.forEach(fileName => 
            {
                let {PythonShell} = require('python-shell')

                let options = {
                    args: [fileName]
                };

                let fields = ["eliminations", "assists", "revives", "accuracy", "damage taken", "position"]

                PythonShell.run('./ForniteAPI/src/Main.py', options, function  (err, results)  {
                    if  (err)  throw err;

                  //Writes data to database                  
                  var sql = mysql.format("INSERT INTO stats (id, kills,assists,revives,accuracy,damageTaken, position) VALUES (?, ?, ?, ? ,?, ?, ?)", [id, results[0], results[1], results[2], results[3], results[4], results[5] ]);
                  id++;
                  // execute the insert statement
                  connection.query(sql, function (err, result) 
                  {
                      if(err)
                      {
                          console.log("An error ocurred performing the query.");
                          console.log(err);
                          return;
                      }
                      console.log("INSERT Query succesfully executed");
                  });

                  //Retrieves data from database
                  var query =  "SELECT kills, assists, revives, accuracy, damageTaken, position FROM stats;";

                  // execute the select statement
                  connection.query(query, function(err, rows, results) 
                  {
                    if(err)
                    {
                        console.log("An error ocurred performing the query.");
                        console.log(err);
                        return;
                    }
                          //Stores data from database to array
                          FortNiteData[0] = rows[ctr].kills;
                          FortNiteData[1] = rows[ctr].assists;
                          FortNiteData[2] = rows[ctr].revives;
                          FortNiteData[3] = rows[ctr].accuracy;
                          FortNiteData[4] = rows[ctr].damageTaken;
                          FortNiteData[5] = rows[ctr].position;

                          ctr++

                      let title = document.createElement("h3")
                      let text = document.createTextNode("Game " + i.toString())
                      title.appendChild(text)
                      document.body.append(title)

                      let table = document.createElement("TABLE");
                      table.setAttribute("id", fileName + "table");
                      document.body.append(table);

                      let row1 = document.createElement("TR");
                      row1.setAttribute("id", fileName + "row1");
                      document.getElementById(fileName + "table").appendChild(row1);

                      let row2 = document.createElement("TR");
                      row2.setAttribute("id", fileName + "row2");
                      document.getElementById(fileName + "table").appendChild(row2);

                      //Header
                      for(let i = 0; i < fields.length; i++)
                      {
                          let data = document.createElement("TH");
                          let text = document.createTextNode(fields[i]);
                          data.appendChild(text);
                          document.getElementById(fileName + "row1").appendChild(data);
                      }

                      //Appends data from database into table
                      for(let i = 0; i < FortNiteData.length; i++)
                      {
                          let data = document.createElement("TD");
                          let text = document.createTextNode(FortNiteData[i]);
                          data.appendChild(text);
                          document.getElementById(fileName + "row2").appendChild(data);
                      }

                      // quick, dirty solution to add some spacing
                      let pad = document.createElement("p");
                      let t = document.createTextNode("");
                      pad.appendChild(t);
                      document.getElementById(fileName + "table").appendChild(pad);

                      i++

                });
              });
            });


        </script>

    </body>

</html>
